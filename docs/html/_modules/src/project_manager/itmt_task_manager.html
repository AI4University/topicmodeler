<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>src.project_manager.itmt_task_manager &mdash; Topic Modeler documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> IntelComp_Topic_Modeler
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ITMT_mainCMD.html">ITMT_mainCMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ITMT_mainGUI.html">ITMT_mainGUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../JSONadapter.html">JSONadapter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../TMinferencer.html">TMinferencer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../corpus2JSON.html">corpus2JSON</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../src.html">src</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../topicmodeling.html">topicmodeling</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">IntelComp_Topic_Modeler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>src.project_manager.itmt_task_manager</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for src.project_manager.itmt_task_manager</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">* *IntelComp H2020 project*</span>

<span class="sd">Task Manager for the Interactive Topic Model Trainer App</span>
<span class="sd">It implements the functions needed to</span>

<span class="sd">    - Generate training datasets from datalake collections</span>
<span class="sd">    - Train topic models</span>
<span class="sd">    - Curate topic models</span>
<span class="sd">    - Do inference with topic models</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">configparser</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">DT</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pyarrow.parquet</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="c1"># import numpy as np</span>
<span class="c1"># import time</span>
<span class="c1"># import re</span>
<span class="c1"># import regex as javare</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="c1"># from gensim import corpora</span>
<span class="c1"># from gensim.utils import check_output</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">check_output</span>
<span class="c1"># from sklearn.preprocessing import normalize</span>
<span class="c1"># from topicmodeler.topicmodeling import MalletTrainer, TMmodel</span>
<span class="kn">from</span> <span class="nn">PyQt6</span> <span class="kn">import</span> <span class="n">QtWidgets</span>
<span class="kn">from</span> <span class="nn">PyQt6.QtWidgets</span> <span class="kn">import</span> <span class="n">QMessageBox</span>

<span class="c1"># Local imports</span>
<span class="kn">from</span> <span class="nn">.base_task_manager</span> <span class="kn">import</span> <span class="n">BaseTaskManager</span>
<span class="kn">from</span> <span class="nn">src.utils.misc</span> <span class="kn">import</span> <span class="n">query_options</span><span class="p">,</span> <span class="n">var_num_keyboard</span><span class="p">,</span> <span class="n">request_confirmation</span>
<span class="kn">from</span> <span class="nn">src.utils.misc</span> <span class="kn">import</span> <span class="n">printgr</span><span class="p">,</span> <span class="n">printred</span><span class="p">,</span> <span class="n">printmag</span>
<span class="kn">from</span> <span class="nn">..gui.utils.constants</span> <span class="kn">import</span> <span class="n">Constants</span>


<div class="viewcode-block" id="ITMTTaskManager"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManager">[docs]</a><span class="k">class</span> <span class="nc">ITMTTaskManager</span><span class="p">(</span><span class="n">BaseTaskManager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class extends the functionality of the baseTaskManager class for a</span>
<span class="sd">    specific example application</span>
<span class="sd">    This class inherits from the baseTaskManager class, which provides the</span>
<span class="sd">    basic method to create, load and set up an application project.</span>
<span class="sd">    The behavior of this class might depend on the state of the project, in</span>
<span class="sd">    dictionary self.state, with the following entries:</span>
<span class="sd">    - &#39;isProject&#39;   : If True, project created. Metadata variables loaded</span>
<span class="sd">    - &#39;configReady&#39; : If True, config file successfully loaded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ITMTTaskManager.__init__"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManager.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p2p</span><span class="p">,</span> <span class="n">p2parquet</span><span class="p">,</span> <span class="n">config_fname</span><span class="o">=</span><span class="s1">&#39;parameters.yaml&#39;</span><span class="p">,</span>
                 <span class="n">metadata_fname</span><span class="o">=</span><span class="s1">&#39;metadata.yaml&#39;</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes an ITMTTaskManager object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p2p : pathlib.Path</span>
<span class="sd">            Path to the application project</span>
<span class="sd">        p2parquet : pathlib.Path</span>
<span class="sd">            Path to the folder hosting the parquet datasets</span>
<span class="sd">        config_fname : str, optional (default=&#39;config.cf&#39;)</span>
<span class="sd">            Name of the configuration file</span>
<span class="sd">        metadata_fname : str or None, optional (default=metadata.yaml)</span>
<span class="sd">            Name of the project metadata file.</span>
<span class="sd">            If None, no metadata file is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Attributes that will be initialized in the base class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path2metadata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2parquet</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata_fname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready2setup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Attributes to load project&#39;s associated datasets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allDtsets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allTrDtsets</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p2p</span><span class="p">,</span> <span class="n">p2parquet</span><span class="p">,</span> <span class="n">config_fname</span><span class="o">=</span><span class="n">config_fname</span><span class="p">,</span>
                         <span class="n">metadata_fname</span><span class="o">=</span><span class="n">metadata_fname</span><span class="p">)</span>

        <span class="c1"># This is a dictionary that contains a list to all subdirectories</span>
        <span class="c1"># that should exist in the project folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;datasets&#39;</span><span class="p">:</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;LDAmodels&#39;</span><span class="p">:</span> <span class="s1">&#39;LDAmodels&#39;</span><span class="p">}</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManager.load"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManager.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extends the load method from the parent class to load into execution time the datasets that have been</span>
<span class="sd">        retrieved from HDFS and are available in the p2parquet provided by the user, as well as all the (logical)</span>
<span class="sd">        Datasets available for the training of topic models which were created in previous executions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_listDownloaded</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_listTrDtsets</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManager.load_listDownloaded"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManager.load_listDownloaded">[docs]</a>    <span class="k">def</span> <span class="nf">load_listDownloaded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method loads all the datasets that have been retrieved from HDFS and are available for the Model Trainer</span>
<span class="sd">        into the ITMTTaskManager&#39;s &#39;allDtsets&#39; attribute as a dictionary object, which is characterized by one dictionary</span>
<span class="sd">        entry per dataset, the key and the value being the absolute path to the dataset and a dictionary with the</span>
<span class="sd">        corresponding metadata, respectively. To do so, it invokes the script from the folder &#39;src/manageCorpus&#39; with</span>
<span class="sd">        the option &#39;listDownloaded&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># @TODO: Check whether it is better to utilized subprocess.pipe to invoke this and following functions&#39; cmds.</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;python src/manageCorpus/manageCorpus.py --listDownloaded --parquet &#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2parquet</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
        <span class="n">printred</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- -- Running command </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allDtsets</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- -- Execution of script failed&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downloaded datasets loaded&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManager.load_listTrDtsets"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManager.load_listTrDtsets">[docs]</a>    <span class="k">def</span> <span class="nf">load_listTrDtsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method loads all the (logical) datasets that are available for the training of topic models into the</span>
<span class="sd">        ITMTTaskManager&#39;s &#39;allTrDtsets&#39; attribute as a dictionary object, which is characterized by one dictionary</span>
<span class="sd">        entry per dataset, the key and the value being the absolute path to the dataset and a dictionary with the</span>
<span class="sd">        corresponding metadata, respectively. To do so, it invokes the script from the folder &#39;src/manageCorpus&#39; with</span>
<span class="sd">        the option &#39;listTrDtsets&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;python src/manageCorpus/manageCorpus.py --listTrDtsets --path_datasets &#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;datasets&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
        <span class="n">printred</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- -- Running command </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allTrDtsets</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- -- Execution of script failed&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Logical datasets loaded&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManager.save_TrDtset"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManager.save_TrDtset">[docs]</a>    <span class="k">def</span> <span class="nf">save_TrDtset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt_set</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method saves the (logical) training dataset specified by &#39;dt_set&#39; in the dataset folder contained within</span>
<span class="sd">        the project folder. To do so, it invokes the script from the folder &#39;src/manageCorpus&#39; with the option</span>
<span class="sd">        &#39;saveTrDtset&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dt_set :</span>
<span class="sd">            Dictionary with Training Dataset information</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : int</span>
<span class="sd">            - 0 if the dataset could not be created</span>
<span class="sd">            - 1 if the dataset was created successfully</span>
<span class="sd">            - 2 if the dataset replaced an existing dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;echo &quot;&#39;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dt_set</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s1">&#39;| python src/manageCorpus/manageCorpus.py --saveTrDtset --path_datasets &#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;datasets&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- -- Running command </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- -- Execution of script failed&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Reload the list of training datasets to consider the new ones added during the current execution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_listTrDtsets</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">status</span></div>

<div class="viewcode-block" id="ITMTTaskManager.delete_TrDtset"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManager.delete_TrDtset">[docs]</a>    <span class="k">def</span> <span class="nf">delete_TrDtset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt_set</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method deletes the (logical) training dataset specified by &#39;dt_set&#39; from the dataset folder contained</span>
<span class="sd">        within the project folder. To do so, it invokes the script from the folder &#39;src/manageCorpus&#39; with the option</span>
<span class="sd">        &#39;deleteTrDtset&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dt_set : str</span>
<span class="sd">            String representation of the path to the json file with the training dataset information</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : int</span>
<span class="sd">            - 0 if the dataset could not be deleted</span>
<span class="sd">            - 1 if the dataset was deleted successfully</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;python src/manageCorpus/manageCorpus.py --deleteTrDtset --path_TrDtset &#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">+</span> <span class="n">dt_set</span>
        <span class="n">printred</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- -- Running command </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The training set was deleted&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Deletion failed&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- -- Execution of script failed&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Deletion failed&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">status</span></div></div>


<span class="c1">##############################################################################</span>
<span class="c1">#                          ITMTTaskManagerCMD                                #</span>
<span class="c1">##############################################################################</span>
<div class="viewcode-block" id="ITMTTaskManagerCMD"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD">[docs]</a><span class="k">class</span> <span class="nc">ITMTTaskManagerCMD</span><span class="p">(</span><span class="n">ITMTTaskManager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides extra functionality to the task manager, requesting parameters</span>
<span class="sd">    from users from a command window.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ITMTTaskManagerCMD.__init__"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p2p</span><span class="p">,</span> <span class="n">p2parquet</span><span class="p">,</span> <span class="n">config_fname</span><span class="o">=</span><span class="s1">&#39;config.cf&#39;</span><span class="p">,</span>
                 <span class="n">metadata_fname</span><span class="o">=</span><span class="s1">&#39;metadata.yaml&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes an ITMTTaskManagerCMD object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p2p : pathlib.Path</span>
<span class="sd">            Path to the application project</span>
<span class="sd">        p2parquet : pathlib.Path</span>
<span class="sd">            Path to the folder hosting the parquet datasets</span>
<span class="sd">        config_fname : str, optional (default=&#39;config.cf&#39;)</span>
<span class="sd">            Name of the configuration file</span>
<span class="sd">        metadata_fname : str or None, optional (default=metadata.yaml)</span>
<span class="sd">            Name of the project metadata file.</span>
<span class="sd">            If None, no metadata file is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">p2p</span><span class="p">,</span> <span class="n">p2parquet</span><span class="p">,</span> <span class="n">config_fname</span><span class="o">=</span><span class="n">config_fname</span><span class="p">,</span> <span class="n">metadata_fname</span><span class="o">=</span><span class="n">metadata_fname</span><span class="p">)</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.fromHDFS"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.fromHDFS">[docs]</a>    <span class="k">def</span> <span class="nf">fromHDFS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method simulates the download of a corpus from the IntelComp data space</span>
<span class="sd">        </span>
<span class="sd">        In the version that will be taken to production, this method will not be necessary</span>
<span class="sd">        and data will be directly retrieved from the data datalogue using IntelComp mediators</span>

<span class="sd">        This needs to be linked with the Data mediator</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">displaytext</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        *************************************************************************************</span>
<span class="s2">        This method simulates the download of a corpus from the IntelComp data space</span>
<span class="s2">        </span>
<span class="s2">        In the version that will be taken to production, this method will not be necessary</span>
<span class="s2">        and data will be directly retrieved from the data catalogue using IntelComp mediators</span>

<span class="s2">        This needs to be linked with the Data mediator</span>
<span class="s2">        *************************************************************************************</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">printred</span><span class="p">(</span><span class="n">displaytext</span><span class="p">)</span>

        <span class="c1"># We need the user to specify table, fields to include, filtering conditions</span>
        <span class="c1"># Available tables in HDFS are read from config file</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="s1">&#39;HDFS&#39;</span><span class="p">]:</span>
            <span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="p">[</span><span class="s1">&#39;HDFS&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
        <span class="n">tables_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">table_opt</span> <span class="o">=</span> <span class="n">query_options</span><span class="p">(</span><span class="n">tables_list</span><span class="p">,</span> <span class="s1">&#39;Select the dataset you wish to download&#39;</span><span class="p">)</span>
        <span class="n">parquet_table</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="n">tables_list</span><span class="p">[</span><span class="n">table_opt</span><span class="p">]]</span>

        <span class="c1"># Select fields to include</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Reference to available fields: https://intelcomp-uc3m.atlassian.net/wiki/spaces/INTELCOMPU/pages&#39;</span>
            <span class="s1">&#39;/884737/Status+of+UC3M+data+sets+for+WP2&#39;</span><span class="p">)</span>
        <span class="n">selectFields</span> <span class="o">=</span> <span class="s2">&quot;fieldsOfStudy, year, ... (id not necessary)&quot;</span>
        <span class="n">sf</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">sf</span><span class="p">):</span>
            <span class="n">sf</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fields to include in dataset [</span><span class="si">{</span><span class="n">selectFields</span><span class="si">}</span><span class="s2">]: &quot;</span><span class="p">)</span>
        <span class="n">selectFields</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)])</span>

        <span class="n">filterCondition</span> <span class="o">=</span> <span class="s2">&quot;array_contains(fieldsOfStudy, &#39;Computer Science&#39;)&quot;</span>
        <span class="n">filterCondition</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filter to apply [</span><span class="si">{</span><span class="n">filterCondition</span><span class="si">}</span><span class="s2">]: &quot;</span><span class="p">)</span>
        <span class="c1"># This is not very smart. Used for being able to send arguments with</span>
        <span class="c1"># &quot;&#39;&quot; or &quot; &quot; to the spark job</span>
        <span class="n">filterCondition</span> <span class="o">=</span> <span class="n">filterCondition</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;SsS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;XxX&quot;</span><span class="p">)</span>

        <span class="c1"># We need a name for the dataset</span>
        <span class="n">dtsName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtsName</span><span class="p">):</span>
            <span class="n">dtsName</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Introduce a name for the dataset: &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dtsName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.parquet&#39;</span><span class="p">):</span>
            <span class="n">dtsName</span> <span class="o">+=</span> <span class="s1">&#39;.parquet&#39;</span>
        <span class="n">path_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2parquet</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">dtsName</span><span class="p">)</span>
        <span class="n">path_dataset</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Introduce a description for the dataset</span>
        <span class="n">dtsDesc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtsDesc</span><span class="p">):</span>
            <span class="n">dtsDesc</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Introduce a description for the dataset: &#39;</span><span class="p">)</span>

        <span class="c1"># Define privacy level of dataset</span>
        <span class="n">privacy</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Public&#39;</span><span class="p">,</span> <span class="s1">&#39;Private&#39;</span><span class="p">]</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">query_options</span><span class="p">(</span><span class="n">privacy</span><span class="p">,</span> <span class="s1">&#39;Define visibility for the dataset&#39;</span><span class="p">)</span>
        <span class="n">privacy</span> <span class="o">=</span> <span class="n">privacy</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span>

        <span class="c1"># printgr(&#39;Parquet_table: &#39; + parquet_table)</span>
        <span class="c1"># printgr(&#39;SelectFields: &#39; + selectFields)</span>
        <span class="c1"># printgr(&#39;filterCondition: &#39;  + filterCondition)</span>
        <span class="c1"># printgr(&#39;Pathdataset: &#39; +path_dataset.resolve().as_posix())</span>
        <span class="n">options</span> <span class="o">=</span> <span class="s1">&#39;&quot;-p &#39;</span> <span class="o">+</span> <span class="n">parquet_table</span> <span class="o">+</span> <span class="s1">&#39; -s &#39;</span> <span class="o">+</span> <span class="n">selectFields</span> <span class="o">+</span> \
                  <span class="s1">&#39; -d &#39;</span> <span class="o">+</span> <span class="n">path_dataset</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filterCondition</span><span class="p">):</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">options</span> <span class="o">+</span> <span class="s1">&#39; -f &#39;</span> <span class="o">+</span> <span class="n">filterCondition</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">options</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
        <span class="c1"># =*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*</span>
        <span class="c1"># This fragment of code creates a sparck cluster and submits the task</span>
        <span class="c1"># This function is dependent on UC3M local deployment infrastructure</span>
        <span class="c1"># and will not work in BSC production environment</span>
        <span class="c1"># In any case, this function will be replaced by the DataCatalogue</span>
        <span class="c1"># import functionalities, so no need to worry about setting it right,</span>
        <span class="c1"># it will not get into production</span>
        <span class="c1"># =*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*</span>
        <span class="n">script_spark</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Spark&#39;</span><span class="p">,</span> <span class="s1">&#39;script_spark&#39;</span><span class="p">)</span>
        <span class="n">token_spark</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Spark&#39;</span><span class="p">,</span> <span class="s1">&#39;token_spark&#39;</span><span class="p">)</span>
        <span class="n">script_path</span> <span class="o">=</span> <span class="s1">&#39;/export/usuarios_ml4ds/jarenas/github/IntelComp/ITMT/topicmodeler/aux/fromHDFS/fromHDFS.py&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">script_spark</span> <span class="o">+</span> <span class="s1">&#39; -C &#39;</span> <span class="o">+</span> <span class="n">token_spark</span> <span class="o">+</span> \
              <span class="s1">&#39; -c 4 -N 10 -S &#39;</span> <span class="o">+</span> <span class="n">script_path</span> <span class="o">+</span> <span class="s1">&#39; -P &#39;</span> <span class="o">+</span> <span class="n">options</span>
        <span class="n">printred</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- -- Running command </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- -- Execution of script failed&#39;</span><span class="p">)</span>
        <span class="c1"># =*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*</span>

        <span class="n">datasetMeta</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">dtsName</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">dtsDesc</span><span class="p">,</span>
            <span class="s2">&quot;visibility&quot;</span><span class="p">:</span> <span class="n">privacy</span><span class="p">,</span>
            <span class="s2">&quot;download_date&quot;</span><span class="p">:</span> <span class="n">DT</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="c1"># &quot;records&quot;       : len(pd.read_parquet(path_dataset, columns=[])),</span>
            <span class="s2">&quot;records&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">([</span><span class="n">pt</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[])</span><span class="o">.</span><span class="n">num_rows</span>
                            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">path_dataset</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.parquet&#39;</span><span class="p">)]),</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">tables_list</span><span class="p">[</span><span class="n">table_opt</span><span class="p">],</span>
            <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="n">pt</span><span class="o">.</span><span class="n">read_schema</span><span class="p">([</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">path_dataset</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
                                      <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.parquet&#39;</span><span class="p">)][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">names</span>
        <span class="p">}</span>

        <span class="k">with</span> <span class="n">path_dataset</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;datasetMeta.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">datasetMeta</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.listDownloaded"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.listDownloaded">[docs]</a>    <span class="k">def</span> <span class="nf">listDownloaded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method shows all Datasets that have been retrieved from HDFS</span>
<span class="sd">        and are available for the Model Trainer in the command line window.</span>

<span class="sd">        This is an extremely simple method for the taskmanager that does not</span>
<span class="sd">        require any user interaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">allDtsets</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allDtsets</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">Dts</span> <span class="ow">in</span> <span class="n">allDtsets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">printmag</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Dataset &#39;</span> <span class="o">+</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Source:&#39;</span><span class="p">,</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Description:&#39;</span><span class="p">,</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Fields:&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;schema&#39;</span><span class="p">]]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Number of docs:&#39;</span><span class="p">,</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;records&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Download date:&#39;</span><span class="p">,</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;download_date&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Visibility:&#39;</span><span class="p">,</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;visibility&#39;</span><span class="p">])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.createTMCorpus"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.createTMCorpus">[docs]</a>    <span class="k">def</span> <span class="nf">createTMCorpus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method creates a training dataset for Topic Modeling</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># We need first to get all available (downloaded) datasets</span>
        <span class="n">allDtsets</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allDtsets</span><span class="p">)</span>

        <span class="c1"># Now we start user interaction to gather datasets</span>
        <span class="n">displaytext</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        *************************************************************************************</span>
<span class="s2">        Generation of Training corpus for Topic Modeling</span>

<span class="s2">        You need to select one or more data sets; for each data set you need to select:</span>

<span class="s2">            1 - The column that will be used as the id</span>
<span class="s2">            2 - The columns that will be used for the rawtext</span>
<span class="s2">            3 - The columns that contain the lemmas</span>
<span class="s2">            4 - Any additional filtering condition in Spark format (advanced users only)</span>
<span class="s2">                (e.g.: array_contains(fieldsOfStudy, &#39;Computer Science&#39;))</span>
<span class="s2">            5 - A domain selection model (To be implemented)</span>
<span class="s2">            6 - A set of level three FOS codes (To be implemented)</span>
<span class="s2">        </span>
<span class="s2">        *************************************************************************************</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">printgr</span><span class="p">(</span><span class="n">displaytext</span><span class="p">)</span>

        <span class="n">Dtsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">allDtsets</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">allDtsets</span><span class="p">[</span><span class="n">el</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">Dtsets</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Finish selection&#39;</span><span class="p">]</span>
        <span class="n">TM_Dtset</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">exit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">exit</span><span class="p">:</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">query_options</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Select a corpus for the training dataset&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">opt</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">exit</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Dtset_loc</span> <span class="o">=</span> <span class="n">Dtsets</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
                <span class="n">Dtset_source</span> <span class="o">=</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dtset_loc</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span>
                <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Processing dataset&#39;</span><span class="p">,</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dtset_loc</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Available columns:&#39;</span><span class="p">,</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dtset_loc</span><span class="p">][</span><span class="s1">&#39;schema&#39;</span><span class="p">])</span>

                <span class="c1"># id fld</span>
                <span class="n">Dtset_idfld</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">while</span> <span class="n">Dtset_idfld</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dtset_loc</span><span class="p">][</span><span class="s1">&#39;schema&#39;</span><span class="p">]:</span>
                    <span class="n">Dtset_idfld</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Select the field to use as identifier: &#39;</span><span class="p">)</span>

                <span class="c1"># lemmas fields</span>
                <span class="n">Dtset_lemmas_fld</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Select fields for lemmas (separated by commas): &#39;</span><span class="p">)</span>
                <span class="n">Dtset_lemmas_fld</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">Dtset_lemmas_fld</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                <span class="n">Dtset_lemmas_fld</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">Dtset_lemmas_fld</span>
                                    <span class="k">if</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dtset_loc</span><span class="p">][</span><span class="s1">&#39;schema&#39;</span><span class="p">]]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selected:&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Dtset_lemmas_fld</span><span class="p">))</span>

                <span class="c1"># rawtext fields</span>
                <span class="n">Dtset_rawtext_fld</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Select fields for rawtext (separated by commas): &#39;</span><span class="p">)</span>
                <span class="n">Dtset_rawtext_fld</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">Dtset_rawtext_fld</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                <span class="n">Dtset_rawtext_fld</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">Dtset_rawtext_fld</span>
                                     <span class="k">if</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dtset_loc</span><span class="p">][</span><span class="s1">&#39;schema&#39;</span><span class="p">]]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selected:&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Dtset_rawtext_fld</span><span class="p">))</span>

                <span class="c1"># Spark clause for filtering (advanced users only)</span>
                <span class="n">Dtset_filter</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Introduce a filtering condition for Spark clause (advanced users): &#39;</span><span class="p">)</span>

                <span class="n">TM_Dtset</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;parquet&#39;</span><span class="p">:</span> <span class="n">Dtset_loc</span><span class="p">,</span>
                                 <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">Dtset_source</span><span class="p">,</span>
                                 <span class="s1">&#39;idfld&#39;</span><span class="p">:</span> <span class="n">Dtset_idfld</span><span class="p">,</span>
                                 <span class="s1">&#39;lemmasfld&#39;</span><span class="p">:</span> <span class="n">Dtset_lemmas_fld</span><span class="p">,</span>
                                 <span class="s1">&#39;rawtxtfld&#39;</span><span class="p">:</span> <span class="n">Dtset_rawtext_fld</span><span class="p">,</span>
                                 <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="n">Dtset_filter</span>
                                 <span class="p">})</span>

        <span class="c1"># We need a name for the dataset</span>
        <span class="n">dtsName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtsName</span><span class="p">):</span>
            <span class="n">dtsName</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Introduce a name for the training dataset: &#39;</span><span class="p">)</span>

        <span class="c1"># Introduce a description for the dataset</span>
        <span class="n">dtsDesc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtsDesc</span><span class="p">):</span>
            <span class="n">dtsDesc</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Introduce a description: &#39;</span><span class="p">)</span>

        <span class="c1"># Define privacy level of dataset</span>
        <span class="n">privacy</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Public&#39;</span><span class="p">,</span> <span class="s1">&#39;Private&#39;</span><span class="p">]</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">query_options</span><span class="p">(</span><span class="n">privacy</span><span class="p">,</span> <span class="s1">&#39;Define visibility for the dataset&#39;</span><span class="p">)</span>
        <span class="n">privacy</span> <span class="o">=</span> <span class="n">privacy</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span>

        <span class="n">Dtset</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">dtsName</span><span class="p">,</span>
                 <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">dtsDesc</span><span class="p">,</span>
                 <span class="s1">&#39;valid_for&#39;</span><span class="p">:</span> <span class="s2">&quot;TM&quot;</span><span class="p">,</span>
                 <span class="s1">&#39;visibility&#39;</span><span class="p">:</span> <span class="n">privacy</span><span class="p">,</span>
                 <span class="s1">&#39;Dtsets&#39;</span><span class="p">:</span> <span class="n">TM_Dtset</span>
                 <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_TrDtset</span><span class="p">(</span><span class="n">Dtset</span><span class="p">)</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.listTMCorpus"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.listTMCorpus">[docs]</a>    <span class="k">def</span> <span class="nf">listTMCorpus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method shows all (logical) Datasets available for training </span>
<span class="sd">        Topic Models in the command line window.</span>

<span class="sd">        This is an extremely simple method for the taskmanager that does not</span>
<span class="sd">        require any user interaction</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">allTrDtsets</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allTrDtsets</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">TrDts</span> <span class="ow">in</span> <span class="n">allTrDtsets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">printmag</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Training Dataset &#39;</span> <span class="o">+</span> <span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Description:&#39;</span><span class="p">,</span> <span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Valid for:&#39;</span><span class="p">,</span> <span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;valid_for&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Creation date:&#39;</span><span class="p">,</span> <span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;creation_date&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Visibility:&#39;</span><span class="p">,</span> <span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;visibility&#39;</span><span class="p">])</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.deleteTMCorpus"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.deleteTMCorpus">[docs]</a>    <span class="k">def</span> <span class="nf">deleteTMCorpus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete Training Corpus from the Interactive Topic Model Trainer</span>
<span class="sd">        dataset folder</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Show available training datasets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listTMCorpus</span><span class="p">()</span>

        <span class="n">allTrDtsets</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allTrDtsets</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">TrDts</span> <span class="ow">in</span> <span class="n">allTrDtsets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">Y_or_N</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Remove Training Set </span><span class="si">{</span><span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> [Y/N]?: &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Y_or_N</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">request_confirmation</span><span class="p">(</span>
                        <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Training Dataset &#39;</span> <span class="o">+</span> <span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; will be deleted. Proceed?&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_TrDtset</span><span class="p">(</span><span class="n">TrDts</span><span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.corpus2JSON"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.corpus2JSON">[docs]</a>    <span class="k">def</span> <span class="nf">corpus2JSON</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a training corpus from the Interactive Topic Model Trainer</span>

<span class="sd">        This is linked to the ITMTrainer only tentatively, since it should</span>
<span class="sd">        be part of WP4 tools</span>

<span class="sd">        Right now, it only runs the generation of the JSON files that are</span>
<span class="sd">        needed for ingestion of the corpus in Solr</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;corpus2JSON&#39;</span><span class="p">)</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;/export/usuarios_ml4ds/jarenas/script-spark/script-spark &#39;</span> <span class="o">+</span> \
              <span class="s1">&#39;-C /export/usuarios_ml4ds/jarenas/script-spark/tokencluster.json &#39;</span> <span class="o">+</span> \
              <span class="s1">&#39;-c 4 -N 10 -S &quot;corpus2JSON.py&quot;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- -- Running command </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- -- Execution of script failed&#39;</span><span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.trainTM"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.trainTM">[docs]</a>    <span class="k">def</span> <span class="nf">trainTM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Topic modeling trainer. Initial training of a topic model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trainer:</span>
<span class="sd">            TM optimizer [mallet/ctm]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">############################################################</span>
        <span class="c1">## IMT Interface: Topic Model Trainer Window</span>
        <span class="c1">############################################################</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- Topic Model Training&#39;</span><span class="p">)</span>

        <span class="c1"># First thing to do is to select a corpus</span>
        <span class="c1"># Ask user which dataset should be used for model training</span>
        <span class="n">dtSets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;datasets&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
        <span class="n">dtSets</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dtSets</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()])</span>
        <span class="n">display_dtSets</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dtSets</span><span class="p">]</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">query_options</span><span class="p">(</span><span class="n">display_dtSets</span><span class="p">,</span> <span class="s2">&quot;Select Training Dataset&quot;</span><span class="p">)</span>
        <span class="n">path_dtSet</span> <span class="o">=</span> <span class="n">dtSets</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>
        <span class="c1"># Retrieve all CSV files that form the selected dataset</span>
        <span class="n">dtSetCSV</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">path_dtSet</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;CSV&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
                           <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- -- Selected corpus is </span><span class="si">{</span><span class="n">path_dtSet</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># We also need the user to select/confirm number of topics</span>
        <span class="n">ntopics</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TM&#39;</span><span class="p">,</span> <span class="s1">&#39;ntopics&#39;</span><span class="p">))</span>
        <span class="n">ntopics</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="n">ntopics</span><span class="p">,</span>
                                   <span class="s1">&#39;Please, select the number of topics&#39;</span><span class="p">)</span>

        <span class="c1"># Retrieve parameters for training</span>
        <span class="k">if</span> <span class="n">trainer</span> <span class="o">==</span> <span class="s2">&quot;mallet&quot;</span><span class="p">:</span>
            <span class="c1"># Default values are read from config file</span>
            <span class="n">min_lemas</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;min_lemas&#39;</span><span class="p">))</span>
            <span class="n">no_below</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;no_below&#39;</span><span class="p">))</span>
            <span class="n">no_above</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;no_above&#39;</span><span class="p">))</span>
            <span class="n">keep_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;keep_n&#39;</span><span class="p">))</span>
            <span class="n">token_regexp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;token_regexp&#39;</span><span class="p">)</span>
            <span class="n">mallet_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;mallet_path&#39;</span><span class="p">)</span>
            <span class="n">stw_file</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;default_stw_file&#39;</span><span class="p">)]</span>
            <span class="n">eq_file</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;default_eq_file&#39;</span><span class="p">)]</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">))</span>
            <span class="n">optimize_interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;optimize_interval&#39;</span><span class="p">))</span>
            <span class="n">num_threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;num_threads&#39;</span><span class="p">))</span>
            <span class="n">num_iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;num_iterations&#39;</span><span class="p">))</span>
            <span class="n">doc_topic_thr</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;doc_topic_thr&#39;</span><span class="p">))</span>
            <span class="n">thetas_thr</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MalletTM&#39;</span><span class="p">,</span> <span class="s1">&#39;thetas_thr&#39;</span><span class="p">))</span>

            <span class="c1"># The following settings will only be accessed in the &quot;advance settings panel&quot;</span>
            <span class="n">Y_or_N</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Do you wish to access the advance settings panel [Y/N]?:&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Y_or_N</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                <span class="c1"># Some of them can be confirmed/modified by the user</span>
                <span class="n">min_lemas</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="n">min_lemas</span><span class="p">,</span>
                                             <span class="s1">&#39;Enter minimum number of lemas for the documents in the training set&#39;</span><span class="p">)</span>
                <span class="n">no_below</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="n">no_below</span><span class="p">,</span>
                                            <span class="s1">&#39;Minimum number occurrences to keep words in vocabulary&#39;</span><span class="p">)</span>
                <span class="n">no_above</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">no_above</span><span class="p">,</span>
                                            <span class="s1">&#39;Maximum proportion of documents to keep a word in vocabulary&#39;</span><span class="p">)</span>
                <span class="n">keep_n</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="n">keep_n</span><span class="p">,</span>
                                          <span class="s1">&#39;Maximum vocabulary size&#39;</span><span class="p">)</span>
                <span class="n">tk</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Regular expresion for tokenizer [</span><span class="si">{</span><span class="n">token_regexp</span><span class="si">}</span><span class="s1">]: &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tk</span><span class="p">):</span>
                    <span class="n">token_regexp</span> <span class="o">=</span> <span class="n">tk</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Stopwords will be read from file </span><span class="si">{</span><span class="n">stw_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">swf</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter the path of additional files of stopwords (separated by commas): &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">swf</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">swf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                            <span class="n">stw_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Word equivalences will be read from file </span><span class="si">{</span><span class="n">eq_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">eq</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter the path of an alternative file with equivalent terms: &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eq</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                        <span class="n">eq_file</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span>
                                         <span class="s1">&#39;Prior parameter for the Dirichlet for doc generation&#39;</span><span class="p">)</span>
                <span class="n">optimize_interval</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="n">optimize_interval</span><span class="p">,</span>
                                                     <span class="s1">&#39;Iterations between Dirichlet priors optimization&#39;</span><span class="p">)</span>
                <span class="n">num_threads</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">,</span>
                                               <span class="s1">&#39;Number of threads for mallet parallelization&#39;</span><span class="p">)</span>
                <span class="n">num_iterations</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="n">num_iterations</span><span class="p">,</span>
                                                  <span class="s1">&#39;Number of Gibbs Sampling iterations&#39;</span><span class="p">)</span>
                <span class="n">doc_topic_thr</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">doc_topic_thr</span><span class="p">,</span>
                                                 <span class="s1">&#39;Threshold for topic activation in a doc (mallet training)&#39;</span><span class="p">)</span>
                <span class="n">thetas_thr</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">thetas_thr</span><span class="p">,</span>
                                              <span class="s1">&#39;Threshold for topic activation in a doc (sparsification)&#39;</span><span class="p">)</span>

            <span class="c1"># Create folder for corpus, backup existing folder if necessary</span>
            <span class="n">modelname</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter a name to save the new model: &#39;</span><span class="p">)</span>
            <span class="n">modeldir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;LDAmodels&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">modelname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">modeldir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>

                <span class="c1"># Remove current backup folder, if it exists</span>
                <span class="n">old_model_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">modeldir</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_old/&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">old_model_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">old_model_dir</span><span class="p">)</span>

                <span class="c1"># Copy current project folder to the backup folder.</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">modeldir</span><span class="p">,</span> <span class="n">old_model_dir</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- -- Creating backup of existing model in </span><span class="si">{</span><span class="n">old_model_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Create corpus_folder and save model training configuration</span>
            <span class="n">modeldir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
            <span class="n">configFile</span> <span class="o">=</span> <span class="n">modeldir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;train.config&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">configFile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[Preproc]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;min_lemas = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_lemas</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;no_below = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">no_below</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;no_above = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">no_above</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;keep_n = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">keep_n</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;stw_file = &#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stw_file</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;eq_file = &#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">eq_file</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[Training]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;trainer = mallet</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;token_regexp = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">token_regexp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;mallet_path = &#39;</span> <span class="o">+</span> <span class="n">mallet_path</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ntopics = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ntopics</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;alpha = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;optimize_interval = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">optimize_interval</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;num_threads = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;num_iterations = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;doc_topic_thr = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">doc_topic_thr</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;thetas_thr = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">thetas_thr</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;training_files = &#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">el</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">dtSetCSV</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1">#############################################################</span>
            <span class="c1">## END IMT Interface: Next, the actual training should happen</span>
            <span class="c1">#############################################################</span>

            <span class="c1"># Run command for training model</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;python topicmodeling.py --train --config </span><span class="si">{</span><span class="n">configFile</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- -- Running command </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- -- Command execution failed&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trainer</span> <span class="o">==</span> <span class="s2">&quot;ctm&quot;</span><span class="p">:</span>
            <span class="c1"># Other trainers will be available</span>
            <span class="k">pass</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.extractPipe"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.extractPipe">[docs]</a>    <span class="k">def</span> <span class="nf">extractPipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">):</span>

        <span class="c1"># A proper corpus with BoW, vocabulary, etc .. should exist</span>
        <span class="n">path_corpus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;corpus&#39;</span><span class="p">])</span>
        <span class="n">path_corpus</span> <span class="o">=</span> <span class="n">path_corpus</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span> <span class="o">+</span> <span class="s1">&#39;_corpus.mallet&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path_corpus</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- Pipe extraction: Could not locate corpus file&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Create auxiliary file with only first line from the original corpus file</span>
        <span class="n">path_txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;corpus&#39;</span><span class="p">])</span>
        <span class="n">path_txt</span> <span class="o">=</span> <span class="n">path_txt</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span> <span class="o">+</span> <span class="s1">&#39;_corpus.txt&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">path_txt</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">first_line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="n">path_aux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;corpus&#39;</span><span class="p">])</span>
        <span class="n">path_aux</span> <span class="o">=</span> <span class="n">path_aux</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;corpus_aux.txt&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">path_aux</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">first_line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1">##################################################</span>
        <span class="c1"># We perform the import with the only goal to keep a small</span>
        <span class="c1"># file containing the pipe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-- Extracting pipeline&#39;</span><span class="p">)</span>
        <span class="n">mallet_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TM&#39;</span><span class="p">,</span> <span class="s1">&#39;mallet_path&#39;</span><span class="p">))</span>
        <span class="n">path_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;corpus&#39;</span><span class="p">])</span>
        <span class="n">path_pipe</span> <span class="o">=</span> <span class="n">path_pipe</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;import.pipe&#39;</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mallet_path</span><span class="p">)</span> <span class="o">+</span> \
              <span class="s1">&#39; import-file --use-pipe-from </span><span class="si">%s</span><span class="s1"> --input </span><span class="si">%s</span><span class="s1"> --output </span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">%</span> <span class="p">(</span><span class="n">path_corpus</span><span class="p">,</span> <span class="n">path_aux</span><span class="p">,</span> <span class="n">path_pipe</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- Running command </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- Failed to extract pipeline. Revise command&#39;</span><span class="p">)</span>

        <span class="c1"># Remove auxiliary file</span>
        <span class="n">path_aux</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.inference"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.inference">[docs]</a>    <span class="k">def</span> <span class="nf">inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">):</span>

        <span class="c1"># A proper corpus should exist with the corresponding ipmortation pipe</span>
        <span class="n">path_pipe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;corpus&#39;</span><span class="p">])</span>
        <span class="n">path_pipe</span> <span class="o">=</span> <span class="n">path_pipe</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;import.pipe&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path_pipe</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- Inference error. Importation pipeline not found&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Ask user which model should be used for inference</span>
        <span class="c1"># Final models are enumerated as corpus_givenName</span>
        <span class="n">path_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;modtm&#39;</span><span class="p">])</span>
        <span class="n">models</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">path_model</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()])</span>
        <span class="n">display_models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">models</span><span class="p">]</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">query_options</span><span class="p">(</span><span class="n">display_models</span><span class="p">,</span> <span class="s1">&#39;Select model for the inference&#39;</span><span class="p">)</span>
        <span class="n">path_model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>
        <span class="n">inferencer</span> <span class="o">=</span> <span class="n">path_model</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;inferencer.mallet&#39;</span><span class="p">)</span>

        <span class="c1"># Ask user to provide a valid text file for performing inference</span>
        <span class="c1"># Format of the text will be one document per line, only text</span>
        <span class="c1"># Note all created files will be hosted in same directory, so a good idea</span>
        <span class="c1"># would be to put the file into an empty directory for this purpose</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">txt_file</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Introduce complete path to file with texts for the inference: &#39;</span><span class="p">)</span>
            <span class="n">txt_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">txt_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">txt_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please provide a valid file name&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># The following files will be generated in the same folder</span>
        <span class="n">corpus_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">txt_file</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_corpus.txt&#39;</span><span class="p">)</span>  <span class="c1"># lemmatized texts</span>
        <span class="n">corpus_mallet_inf</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">txt_file</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_corpus.mallet&#39;</span><span class="p">)</span>  <span class="c1"># mallet serialized</span>
        <span class="n">doc_topics_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">txt_file</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_doc-topics.txt&#39;</span><span class="p">)</span>  <span class="c1"># Topic proportions</span>
        <span class="c1"># Reorder topic proportions in numpy format</span>
        <span class="n">doc_topics_file_npy</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">txt_file</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_doc-topics.npy&#39;</span><span class="p">)</span>

        <span class="c1"># Start processing pipeline</span>

        <span class="c1"># ========================</span>
        <span class="c1"># 1. Lemmatization</span>
        <span class="c1"># ========================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-- Inference: Lemmatizing Titles and Abstracts ...&#39;</span><span class="p">)</span>
        <span class="n">lemmas_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Lemmatizer&#39;</span><span class="p">,</span> <span class="s1">&#39;server&#39;</span><span class="p">)</span>
        <span class="n">stw_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Lemmatizer&#39;</span><span class="p">,</span> <span class="s1">&#39;default_stw_file&#39;</span><span class="p">))</span>
        <span class="n">dict_eq_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Lemmatizer&#39;</span><span class="p">,</span> <span class="s1">&#39;default_dict_eq_file&#39;</span><span class="p">))</span>
        <span class="n">POS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Lemmatizer&#39;</span><span class="p">,</span> <span class="s1">&#39;POS&#39;</span><span class="p">)</span>
        <span class="n">concurrent_posts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Lemmatizer&#39;</span><span class="p">,</span> <span class="s1">&#39;concurrent_posts&#39;</span><span class="p">))</span>
        <span class="n">removenumbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Lemmatizer&#39;</span><span class="p">,</span> <span class="s1">&#39;removenumbers&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span>
        <span class="n">keepSentence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Lemmatizer&#39;</span><span class="p">,</span> <span class="s1">&#39;keepSentence&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span>

        <span class="c1"># Initialize lemmatizer</span>
        <span class="n">ENLM</span> <span class="o">=</span> <span class="n">ENLemmatizer</span><span class="p">(</span><span class="n">lemmas_server</span><span class="o">=</span><span class="n">lemmas_server</span><span class="p">,</span> <span class="n">stw_file</span><span class="o">=</span><span class="n">stw_file</span><span class="p">,</span>
                            <span class="n">dict_eq_file</span><span class="o">=</span><span class="n">dict_eq_file</span><span class="p">,</span> <span class="n">POS</span><span class="o">=</span><span class="n">POS</span><span class="p">,</span> <span class="n">removenumbers</span><span class="o">=</span><span class="n">removenumbers</span><span class="p">,</span>
                            <span class="n">keepSentence</span><span class="o">=</span><span class="n">keepSentence</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">txt_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
            <span class="n">docs</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">docs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">el</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">]</span>
        <span class="n">docs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">clean_utf8</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">]</span>
        <span class="n">lemasBatch</span> <span class="o">=</span> <span class="n">ENLM</span><span class="o">.</span><span class="n">lemmatizeBatch</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="n">concurrent_posts</span><span class="p">)</span>
        <span class="c1"># Remove entries that where not lemmatized correctly</span>
        <span class="n">lemasBatch</span> <span class="o">=</span> <span class="p">[[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">clean_utf8</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">lemasBatch</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># ========================</span>
        <span class="c1"># 2. Tokenization and application of specific stopwords</span>
        <span class="c1">#    and equivalences for the corpus</span>
        <span class="c1"># ========================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-- Inference: Applying corpus specific stopwords and equivalences&#39;</span><span class="p">)</span>
        <span class="n">token_regexp</span> <span class="o">=</span> <span class="n">javare</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CorpusGeneration&#39;</span><span class="p">,</span> <span class="s1">&#39;token_regexp&#39;</span><span class="p">))</span>
        <span class="n">corpus_stw</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="s1">&#39;stw_file&#39;</span><span class="p">))</span>
        <span class="n">corpus_eqs</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="s1">&#39;eq_file&#39;</span><span class="p">))</span>

        <span class="c1"># Initialize Cleaner</span>
        <span class="n">stwEQ</span> <span class="o">=</span> <span class="n">stwEQcleaner</span><span class="p">(</span><span class="n">stw_files</span><span class="o">=</span><span class="p">[</span><span class="n">stw_file</span><span class="p">,</span> <span class="n">corpus_stw</span><span class="p">],</span> <span class="n">dict_eq_file</span><span class="o">=</span><span class="n">corpus_eqs</span><span class="p">,</span>
                             <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
        <span class="c1"># tokenization with regular expression</span>
        <span class="n">id_lemas</span> <span class="o">=</span> <span class="p">[[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">token_regexp</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]))]</span>
                    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">lemasBatch</span><span class="p">]</span>
        <span class="c1"># stopwords and equivalences</span>
        <span class="n">id_lemas</span> <span class="o">=</span> <span class="p">[[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stwEQ</span><span class="o">.</span><span class="n">cleanstr</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">id_lemas</span><span class="p">]</span>
        <span class="c1"># No need to apply other transformations, because only known words</span>
        <span class="c1"># in the vocabulary will be used by Mallet for the topic-inference</span>
        <span class="k">with</span> <span class="n">corpus_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
            <span class="p">[</span><span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; 0 &#39;</span> <span class="o">+</span> <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">id_lemas</span><span class="p">]</span>

        <span class="c1"># ========================</span>
        <span class="c1"># 3. Importing Data to mallet</span>
        <span class="c1"># ========================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-- Inference: Mallet Data Import&#39;</span><span class="p">)</span>
        <span class="n">mallet_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TM&#39;</span><span class="p">,</span> <span class="s1">&#39;mallet_path&#39;</span><span class="p">))</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mallet_path</span><span class="p">)</span> <span class="o">+</span> \
              <span class="s1">&#39; import-file --use-pipe-from </span><span class="si">%s</span><span class="s1"> --input </span><span class="si">%s</span><span class="s1"> --output </span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">%</span> <span class="p">(</span><span class="n">path_pipe</span><span class="p">,</span> <span class="n">corpus_file</span><span class="p">,</span> <span class="n">corpus_mallet_inf</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- Running command </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- Mallet failed to import data. Revise command&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># ========================</span>
        <span class="c1"># 4. Get topic proportions</span>
        <span class="c1"># ========================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-- Inference: Inferring Topic Proportions&#39;</span><span class="p">)</span>
        <span class="n">num_iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TM&#39;</span><span class="p">,</span> <span class="s1">&#39;num_iterations_inf&#39;</span><span class="p">))</span>
        <span class="n">doc_topic_thr</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TM&#39;</span><span class="p">,</span> <span class="s1">&#39;doc_topic_thr&#39;</span><span class="p">))</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mallet_path</span><span class="p">)</span> <span class="o">+</span> \
              <span class="s1">&#39; infer-topics --inferencer </span><span class="si">%s</span><span class="s1"> --input </span><span class="si">%s</span><span class="s1"> --output-doc-topics </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">+</span> \
              <span class="s1">&#39; --doc-topics-threshold &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">doc_topic_thr</span><span class="p">)</span> <span class="o">+</span> \
              <span class="s1">&#39; --num-iterations &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">%</span> <span class="p">(</span><span class="n">inferencer</span><span class="p">,</span> <span class="n">corpus_mallet_inf</span><span class="p">,</span> <span class="n">doc_topics_file</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-- Running command </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">check_output</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;-- Mallet inference failed. Revise command&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># ========================</span>
        <span class="c1"># 5. Apply model editions</span>
        <span class="c1"># ========================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-- Inference: Applying model edition transformations&#39;</span><span class="p">)</span>
        <span class="c1"># Load thetas file, apply model edition actions, and save as a numpy array</span>
        <span class="c1"># We need to read the number of topics, e.g. from train_config file</span>
        <span class="n">train_config</span> <span class="o">=</span> <span class="n">path_model</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;train.config&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">train_config</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
            <span class="n">num_topics</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;num-topics&#39;</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">num_topics</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_topics</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; = &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_topics</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">thetas32</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">doc_topics_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
        <span class="n">model_edits</span> <span class="o">=</span> <span class="n">path_model</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;model_edits.txt&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_edits</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">model_edits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
                    <span class="n">line_els</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">line_els</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">line_els</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
                        <span class="n">thetas32</span> <span class="o">=</span> <span class="n">thetas32</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">line_els</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
                        <span class="n">tpc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_els</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">ntopics</span> <span class="o">=</span> <span class="n">thetas32</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">tpc_keep</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntopics</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="n">tpc</span><span class="p">]</span>
                        <span class="n">thetas32</span> <span class="o">=</span> <span class="n">thetas32</span><span class="p">[:,</span> <span class="n">tpc_keep</span><span class="p">]</span>
                        <span class="n">thetas32</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">thetas32</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">line_els</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
                        <span class="n">tpcs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">line_els</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
                        <span class="n">thet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">thetas32</span><span class="p">[:,</span> <span class="n">tpcs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">thetas32</span><span class="p">[:,</span> <span class="n">tpcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">thet</span>
                        <span class="n">thetas32</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">thetas32</span><span class="p">,</span> <span class="n">tpcs</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">thetas32</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">thetas32</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">doc_topics_file_npy</span><span class="p">,</span> <span class="n">thetas32</span><span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.editTM"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.editTM">[docs]</a>    <span class="k">def</span> <span class="nf">editTM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus</span><span class="p">):</span>

        <span class="c1"># Select model for edition</span>
        <span class="c1"># Final models are enumerated as corpus_givenName</span>
        <span class="n">path_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;modtm&#39;</span><span class="p">])</span>
        <span class="n">models</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">path_model</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()])</span>
        <span class="n">display_models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">models</span><span class="p">]</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">query_options</span><span class="p">(</span>
            <span class="n">display_models</span><span class="p">,</span> <span class="s1">&#39;Select the topic model that you want to edit:&#39;</span><span class="p">)</span>
        <span class="n">path_model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>
        <span class="n">tm</span> <span class="o">=</span> <span class="n">TMmodel</span><span class="p">(</span><span class="n">from_file</span><span class="o">=</span><span class="n">path_model</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;modelo.npz&#39;</span><span class="p">),</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

        <span class="n">corpus_size</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">get_thetas</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">var_exit2</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">---------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You are editing topic model:&#39;</span><span class="p">,</span> <span class="n">path_model</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Salir&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Visualizar tópicos&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Visualizar las palabras de los tópicos&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Visualizar palabras de tópicos &quot;basura&quot; vs otros tópicos&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Exportar Visualización pyLDAvis&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Anotación de Stopwords y Equivalencias&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Etiquetado automático de los tópicos del modelo&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Etiquetado manual de tópicos&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Eliminar un tópico del modelo&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Tópicos similares por coocurrencia&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Tópicos similares por palabras&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Fusionar dos tópicos del modelo&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Ordenar tópicos por importancia&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Resetear al modelo original&#39;</span><span class="p">]</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">var_exit2</span><span class="p">:</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Available options&#39;</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="n">query_options</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">msg</span><span class="p">)]</span>

            <span class="k">if</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Salir&#39;</span><span class="p">:</span>
                <span class="n">var_exit2</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Visualizar tópicos&#39;</span><span class="p">:</span>
                <span class="n">tm</span><span class="o">.</span><span class="n">muestra_descriptions</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Visualizar las palabras de los tópicos&#39;</span><span class="p">:</span>
                <span class="n">tm</span><span class="o">.</span><span class="n">muestra_descriptions</span><span class="p">(</span><span class="n">simple</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Visualizar palabras de tópicos &quot;basura&quot; vs otros tópicos&#39;</span><span class="p">:</span>

                <span class="n">ntopics</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">get_ntopics</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Introduce el ID de los tópicos &quot;basura&quot;: &#39;</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tpcsGbg</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                               <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ntopics</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tpcsGbg</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tpcsGbg</span><span class="p">):</span>
                    <span class="n">tpcsOth</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntopics</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tpcsGbg</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No se ha introdido ningún id de tópico válido&#39;</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="c1"># Ahora seleccionamos el número de palabras a seleccionar de los tópicos</span>
                <span class="c1"># basura, y el número de palabras del resto de tópicos</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Introduzca el peso máximo de las palabras de los tópicos basura&#39;</span>
                <span class="n">weighWordsGbg</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Introduzca ahora el peso máximo para las palabras de otros tópicos&#39;</span>
                <span class="n">weighWordsOth</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

                <span class="c1"># Y por último seleccionamos las palabras y hacemos la intersección</span>
                <span class="n">wordsOth</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">tpc</span> <span class="ow">in</span> <span class="n">tpcsOth</span><span class="p">:</span>
                    <span class="n">wordstpc</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">most_significant_words_per_topic</span><span class="p">(</span><span class="n">n_palabras</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tfidf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tpc</span><span class="o">=</span><span class="p">[</span><span class="n">tpc</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">wordstpc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">wordstpc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">weighWordsOth</span><span class="p">:</span>
                        <span class="n">printred</span><span class="p">(</span><span class="s1">&#39;Se supera el límite preestablecido de palabras para el tópico &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tpc</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">wordstpc</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">wordstpc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">wordstpc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">weighWordsOth</span><span class="p">]</span>
                        <span class="n">wordsOth</span> <span class="o">+=</span> <span class="n">wordstpc</span>
                <span class="n">wordsOth</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">wordsOth</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">tpc</span> <span class="ow">in</span> <span class="n">tpcsGbg</span><span class="p">:</span>
                    <span class="n">wordstpc</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">most_significant_words_per_topic</span><span class="p">(</span><span class="n">n_palabras</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tfidf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tpc</span><span class="o">=</span><span class="p">[</span><span class="n">tpc</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">wordstpc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">wordstpc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">weighWordsGbg</span><span class="p">:</span>
                        <span class="n">printred</span><span class="p">(</span><span class="s1">&#39;Se supera el límite preestablecido de palabras para el tópico &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tpc</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">wordstpc</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">wordstpc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">wordstpc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">weighWordsGbg</span><span class="p">]</span>
                        <span class="n">printgr</span><span class="p">(</span><span class="mi">40</span> <span class="o">*</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
                        <span class="n">printgr</span><span class="p">(</span><span class="s1">&#39;Tópico &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tpc</span><span class="p">))</span>
                        <span class="n">printgr</span><span class="p">(</span><span class="s1">&#39;Seleccionadas &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wordstpc</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; palabras&#39;</span><span class="p">)</span>
                        <span class="n">printgr</span><span class="p">(</span><span class="mi">40</span> <span class="o">*</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
                        <span class="n">stwCandidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">wordstpc</span> <span class="k">if</span> <span class="n">el</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wordsOth</span><span class="p">]</span>
                        <span class="n">printmag</span><span class="p">(</span><span class="s1">&#39;Candidatas a StopWord (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stwCandidates</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;):&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">stwCandidates</span><span class="p">)</span>
                        <span class="n">nonStwCandidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">wordstpc</span> <span class="k">if</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">wordsOth</span><span class="p">]</span>
                        <span class="n">printmag</span><span class="p">(</span><span class="s1">&#39;Coincidentes con otros tópicos (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nonStwCandidates</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;):&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">nonStwCandidates</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Exportar Visualización pyLDAvis&#39;</span><span class="p">:</span>
                <span class="n">tm</span><span class="o">.</span><span class="n">pyLDAvis</span><span class="p">(</span><span class="n">path_model</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;pyLDAvis.html&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">(),</span>
                            <span class="n">ndocs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TMedit&#39;</span><span class="p">,</span> <span class="s1">&#39;LDAvis_ndocs&#39;</span><span class="p">)),</span>
                            <span class="n">njobs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TMedit&#39;</span><span class="p">,</span> <span class="s1">&#39;LDAvis_njobs&#39;</span><span class="p">)))</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Anotación de Stopwords y Equivalencias&#39;</span><span class="p">:</span>
                <span class="n">n_palabras</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TMedit&#39;</span><span class="p">,</span> <span class="s1">&#39;n_palabras&#39;</span><span class="p">))</span>
                <span class="n">round_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TMedit&#39;</span><span class="p">,</span> <span class="s1">&#39;round_size&#39;</span><span class="p">))</span>
                <span class="n">words</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">most_significant_words_per_topic</span><span class="p">(</span>
                    <span class="n">n_palabras</span><span class="o">=</span><span class="n">n_palabras</span><span class="p">,</span> <span class="n">tfidf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tpc</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">words</span> <span class="o">=</span> <span class="p">[[</span><span class="n">wd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">wd</span> <span class="ow">in</span> <span class="n">el</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">words</span><span class="p">]</span>
                <span class="c1"># Launch labelling application</span>
                <span class="n">stw</span><span class="p">,</span> <span class="n">eqs</span> <span class="o">=</span> <span class="n">tagfilter</span><span class="o">.</span><span class="n">stw_eq_tool</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">round_size</span><span class="o">=</span><span class="n">round_size</span><span class="p">)</span>
                <span class="n">eqs</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">eqs</span><span class="p">]</span>
                <span class="c1"># Save stopwords and equivalences in corpus specific files</span>
                <span class="n">corpus_stw</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="s1">&#39;stw_file&#39;</span><span class="p">))</span>
                <span class="n">corpus_eqs</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="s1">&#39;eq_file&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">corpus_stw</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                    <span class="k">with</span> <span class="n">corpus_stw</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                        <span class="n">current_stw</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="n">current_stw</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">current_stw</span><span class="p">]</span>
                    <span class="n">stw</span> <span class="o">=</span> <span class="n">stw</span> <span class="o">+</span> <span class="n">current_stw</span>
                <span class="n">stw</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">stw</span><span class="p">)))</span>
                <span class="k">with</span> <span class="n">corpus_stw</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                    <span class="p">[</span><span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">wd</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">wd</span> <span class="ow">in</span> <span class="n">stw</span><span class="p">]</span>
                <span class="c1"># Same for equivalent words</span>
                <span class="k">if</span> <span class="n">corpus_eqs</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                    <span class="k">with</span> <span class="n">corpus_eqs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                        <span class="n">current_eqs</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                    <span class="n">current_eqs</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">current_eqs</span><span class="p">]</span>
                    <span class="n">eqs</span> <span class="o">=</span> <span class="n">eqs</span> <span class="o">+</span> <span class="n">current_eqs</span>
                <span class="n">eqs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">eqs</span><span class="p">)))</span>
                <span class="k">with</span> <span class="n">corpus_eqs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                    <span class="p">[</span><span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">eq</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">eq</span> <span class="ow">in</span> <span class="n">eqs</span><span class="p">]</span>

                <span class="k">return</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Etiquetado automático de los tópicos del modelo&#39;</span><span class="p">:</span>
                <span class="n">tm</span><span class="o">.</span><span class="n">automatic_topic_labeling</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TM&#39;</span><span class="p">,</span> <span class="s1">&#39;pathlabeling&#39;</span><span class="p">),</span>
                                            <span class="n">workers</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TMedit&#39;</span><span class="p">,</span> <span class="s1">&#39;NETLworkers&#39;</span><span class="p">)))</span>
                <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Etiquetado manual de tópicos&#39;</span><span class="p">:</span>
                <span class="n">descriptions</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">get_descriptions</span><span class="p">()</span>
                <span class="n">word_description</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">get_topic_word_descriptions</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">desc</span><span class="p">,</span> <span class="p">(</span><span class="n">tpc</span><span class="p">,</span> <span class="n">worddesc</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">descriptions</span><span class="p">,</span> <span class="n">word_description</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Topic ID:&#39;</span><span class="p">,</span> <span class="n">tpc</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current description:&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Word description:&#39;</span><span class="p">,</span> <span class="n">worddesc</span><span class="p">)</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Introduce the description for the topic, write &quot;wd&quot; use Word Description,</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
                              <span class="s1">&#39;or press enter to keep current:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="s1">&#39;wd&#39;</span><span class="p">:</span>
                        <span class="n">tm</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="n">worddesc</span><span class="p">,</span> <span class="n">tpc</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">r</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">tm</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">tpc</span><span class="p">)</span>
                <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Eliminar un tópico del modelo&#39;</span><span class="p">:</span>
                <span class="n">lista</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ndoc</span><span class="p">,</span> <span class="n">desc</span><span class="p">)</span> <span class="k">for</span> <span class="n">ndoc</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">ndocs_active_topic</span><span class="p">(),</span> <span class="n">tm</span><span class="o">.</span><span class="n">get_topic_word_descriptions</span><span class="p">())]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lista</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
                    <span class="n">perc</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">corpus_size</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; %)&#39;</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ID del tópico:&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Número de documentos en los que está activo:&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">perc</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Palabras más significativas:&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Introduce el ID de los tópicos que deseas eliminar separados por comas&#39;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">o presiona ENTER si no deseas eliminar ningún tópico</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tpcs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                    <span class="c1"># Eliminaremos los tópicos en orden decreciente</span>
                    <span class="n">tpcs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">tpc</span> <span class="ow">in</span> <span class="n">tpcs</span><span class="p">:</span>
                        <span class="n">tm</span><span class="o">.</span><span class="n">delete_topic</span><span class="p">(</span><span class="n">tpc</span><span class="p">)</span>
                    <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debes introducir una lista de topic ids&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Tópicos similares por coocurrencia&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Introduzca el número de pares de tópicos a mostrar&#39;</span>
                <span class="n">npairs</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Introduzca número de palabras para mostrar&#39;</span>
                <span class="n">nwords</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">get_similar_corrcoef</span><span class="p">(</span><span class="n">npairs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Correlación de los tópicos </span><span class="si">{0:d}</span><span class="s1"> y </span><span class="si">{1:d}</span><span class="s1">: </span><span class="si">{2:.2f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">pair</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">printmag</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="n">printmag</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
                    <span class="n">tm</span><span class="o">.</span><span class="n">muestra_perfiles</span><span class="p">(</span><span class="n">n_palabras</span><span class="o">=</span><span class="n">nwords</span><span class="p">,</span> <span class="n">tpc</span><span class="o">=</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">printred</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">printred</span><span class="p">(</span><span class="s1">&#39;Cuidado: los ids de los tópicos cambian tras la fusión o eliminación&#39;</span><span class="p">)</span>
                <span class="n">printred</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Tópicos similares por palabras&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Introduzca umbral para selección de palabras&#39;</span>
                <span class="n">thr</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Introduzca el número de pares de tópicos a mostrar&#39;</span>
                <span class="n">npairs</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Introduzca número de palabras para mostrar&#39;</span>
                <span class="n">nwords</span> <span class="o">=</span> <span class="n">var_num_keyboard</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">get_similar_JSdist</span><span class="p">(</span><span class="n">npairs</span><span class="p">,</span> <span class="n">thr</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Similitud de los tópicos </span><span class="si">{0:d}</span><span class="s1"> y </span><span class="si">{1:d}</span><span class="s1">: </span><span class="si">{2:.2f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">pair</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">printmag</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="n">printmag</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
                    <span class="n">tm</span><span class="o">.</span><span class="n">muestra_perfiles</span><span class="p">(</span><span class="n">n_palabras</span><span class="o">=</span><span class="n">nwords</span><span class="p">,</span> <span class="n">tpc</span><span class="o">=</span><span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">printred</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">printred</span><span class="p">(</span><span class="s1">&#39;Cuidado: los ids de los tópicos cambian tras la fusión o eliminación&#39;</span><span class="p">)</span>
                <span class="n">printred</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Fusionar dos tópicos del modelo&#39;</span><span class="p">:</span>
                <span class="n">tm</span><span class="o">.</span><span class="n">muestra_descriptions</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Introduce el ID de los tópicos que deseas fusionar separados por comas&#39;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">o presiona ENTER si no deseas fusionar ningún tópico</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tpcs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tpcs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">tm</span><span class="o">.</span><span class="n">fuse_topics</span><span class="p">(</span><span class="n">tpcs</span><span class="p">)</span>
                    <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debes introducir una lista de IDs&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Ordenar tópicos por importancia&#39;</span><span class="p">:</span>
                <span class="n">tm</span><span class="o">.</span><span class="n">sort_topics</span><span class="p">()</span>
                <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="n">selection</span> <span class="o">==</span> <span class="s1">&#39;Resetear al modelo original&#39;</span><span class="p">:</span>
                <span class="n">tm</span><span class="o">.</span><span class="n">reset_model</span><span class="p">()</span>
                <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">modified</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">request_confirmation</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Save modified model?&#39;</span><span class="p">):</span>
                <span class="n">tm</span><span class="o">.</span><span class="n">save_npz</span><span class="p">(</span><span class="n">path_model</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;modelo.npz&#39;</span><span class="p">))</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.compute_all_sim_graphs"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.compute_all_sim_graphs">[docs]</a>    <span class="k">def</span> <span class="nf">compute_all_sim_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes all similarity graphs from the available topic models for a</span>
<span class="sd">        given corpus, and save them in a supergraph structure, to be used</span>
<span class="sd">        later in validation processes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus : str</span>
<span class="sd">            Corpus (S24Ever: Semantic Scholar, Crunch4Ever: Crunchbase)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Path to the validation folder for the given corpus</span>
        <span class="n">path2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
        <span class="c1"># Output path to the given corpus</span>
        <span class="n">path2out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;valoutput&#39;</span><span class="p">]</span>
        <span class="c1"># Path to the topic models folder</span>
        <span class="n">model2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_2_validate</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DMs</span><span class="p">,</span> <span class="n">model2val</span><span class="p">,</span> <span class="n">path2val</span><span class="p">,</span> <span class="n">path2out</span><span class="p">,</span>
                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">val_params</span><span class="p">)</span>
        <span class="n">V</span><span class="o">.</span><span class="n">compute_all_sim_graphs</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.compute_reference_graph"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.compute_reference_graph">[docs]</a>    <span class="k">def</span> <span class="nf">compute_reference_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes a reference graph for a given corpus, based on metadata.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus_name : str</span>
<span class="sd">            Name of the corpus</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Path to the validation folder for the given corpus</span>
        <span class="n">path2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
        <span class="c1"># Output path to the given corpus</span>
        <span class="n">path2out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;valoutput&#39;</span><span class="p">]</span>
        <span class="c1"># Path to the topic models folder</span>
        <span class="n">model2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_2_validate</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DMs</span><span class="p">,</span> <span class="n">model2val</span><span class="p">,</span> <span class="n">path2val</span><span class="p">,</span> <span class="n">path2out</span><span class="p">,</span>
                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">val_params</span><span class="p">)</span>
        <span class="n">V</span><span class="o">.</span><span class="n">compute_reference_graph</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.validate_topic_models"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.validate_topic_models">[docs]</a>    <span class="k">def</span> <span class="nf">validate_topic_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyzes the influence of the topic model on te quality of the</span>
<span class="sd">        similarity graphs</span>

<span class="sd">        The similarity graph is validated using a citations graph.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus_name: str</span>
<span class="sd">            Corpus (Pu: Semantic Scholar, or Co: Crunchbase data)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Path to the validation folder for the given corpus</span>
        <span class="n">path2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
        <span class="c1"># Output path to the given corpus</span>
        <span class="n">path2out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;valoutput&#39;</span><span class="p">]</span>
        <span class="c1"># Path to the topic models folder</span>
        <span class="n">model2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_2_validate</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DMs</span><span class="p">,</span> <span class="n">model2val</span><span class="p">,</span> <span class="n">path2val</span><span class="p">,</span> <span class="n">path2out</span><span class="p">,</span>
                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">val_params</span><span class="p">)</span>
        <span class="n">V</span><span class="o">.</span><span class="n">validate_topic_models</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.show_validation_results"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.show_validation_results">[docs]</a>    <span class="k">def</span> <span class="nf">show_validation_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows the results of the topic model validation in</span>
<span class="sd">        self.validate_topic_models()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus_name: str</span>
<span class="sd">            Corpus (Pu: Semantic Scholar, or Co: Crunchbase data)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Path to the validation folder for the given corpus</span>
        <span class="n">path2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
        <span class="c1"># Output path to the given corpus</span>
        <span class="n">path2out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;valoutput&#39;</span><span class="p">]</span>
        <span class="c1"># Path to the topic models folder</span>
        <span class="n">model2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_2_validate</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DMs</span><span class="p">,</span> <span class="n">model2val</span><span class="p">,</span> <span class="n">path2val</span><span class="p">,</span> <span class="n">path2out</span><span class="p">,</span>
                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">val_params</span><span class="p">)</span>
        <span class="n">V</span><span class="o">.</span><span class="n">show_validation_results</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.analyze_variability"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.analyze_variability">[docs]</a>    <span class="k">def</span> <span class="nf">analyze_variability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyzes the influence of the topic model on te quality of the</span>
<span class="sd">        similarity graphs</span>

<span class="sd">        The similarity graph is validated from the analisys of the variability</span>
<span class="sd">        of node relationships in the graph</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus : str</span>
<span class="sd">            Corpus (Pu: Semantic Scholar, or Co: Crunchbase data)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Path to the validation folder for the given corpus</span>
        <span class="n">path2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
        <span class="c1"># Output path to the given corpus</span>
        <span class="n">path2out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;valoutput&#39;</span><span class="p">]</span>
        <span class="c1"># Path to the topic models folder</span>
        <span class="n">model2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_2_validate</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DMs</span><span class="p">,</span> <span class="n">model2val</span><span class="p">,</span> <span class="n">path2val</span><span class="p">,</span> <span class="n">path2out</span><span class="p">,</span>
                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">val_params</span><span class="p">)</span>
        <span class="n">V</span><span class="o">.</span><span class="n">analyze_variability</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.show_variability_results"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.show_variability_results">[docs]</a>    <span class="k">def</span> <span class="nf">show_variability_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows the results of the topic model validation in</span>
<span class="sd">        `self.validate_topic_models()`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus_name: str</span>
<span class="sd">            Corpus (Pu: Semantic Scholar, or Co: Crunchbase data)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Path to the validation folder for the given corpus</span>
        <span class="n">path2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
        <span class="c1"># Output path to the given corpus</span>
        <span class="n">path2out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;valoutput&#39;</span><span class="p">]</span>
        <span class="c1"># Path to the topic models folder</span>
        <span class="n">model2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_2_validate</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DMs</span><span class="p">,</span> <span class="n">model2val</span><span class="p">,</span> <span class="n">path2val</span><span class="p">,</span> <span class="n">path2out</span><span class="p">,</span>
                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">val_params</span><span class="p">)</span>
        <span class="n">V</span><span class="o">.</span><span class="n">show_variability_results</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.analyze_scalability"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.analyze_scalability">[docs]</a>    <span class="k">def</span> <span class="nf">analyze_scalability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyzes the influence of the topic model on te quality of the</span>
<span class="sd">        similarity graphs</span>

<span class="sd">        The similarity graph is validated using a citations graph.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus_name: str</span>
<span class="sd">            Corpus (Pu: Semantic Scholar, or Co: Crunchbase data)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Path to the validation folder for the given corpus</span>
        <span class="n">path2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
        <span class="c1"># Output path to the given corpus</span>
        <span class="n">path2out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;valoutput&#39;</span><span class="p">]</span>
        <span class="c1"># Path to the topic models folder</span>
        <span class="n">model2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_2_validate</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DMs</span><span class="p">,</span> <span class="n">model2val</span><span class="p">,</span> <span class="n">path2val</span><span class="p">,</span> <span class="n">path2out</span><span class="p">,</span>
                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">val_params</span><span class="p">)</span>
        <span class="n">V</span><span class="o">.</span><span class="n">analyze_scalability</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.show_scalability_results"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.show_scalability_results">[docs]</a>    <span class="k">def</span> <span class="nf">show_scalability_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows the results of the topic model validation in</span>
<span class="sd">        `self.validate_topic_models()`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus_name: str</span>
<span class="sd">            Corpus (Pu: Semantic Scholar, or Co: Crunchbase data)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Path to the validation folder for the given corpus</span>
        <span class="n">path2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
        <span class="c1"># Output path to the given corpus</span>
        <span class="n">path2out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;valoutput&#39;</span><span class="p">]</span>
        <span class="c1"># Path to the topic models folder</span>
        <span class="n">model2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_2_validate</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DMs</span><span class="p">,</span> <span class="n">model2val</span><span class="p">,</span> <span class="n">path2val</span><span class="p">,</span> <span class="n">path2out</span><span class="p">,</span>
                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">val_params</span><span class="p">)</span>
        <span class="n">V</span><span class="o">.</span><span class="n">show_scalability_results</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.validate_subtrain_models"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.validate_subtrain_models">[docs]</a>    <span class="k">def</span> <span class="nf">validate_subtrain_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates topics models obtained using a reduced corpus, using a</span>
<span class="sd">        gold standard based o a large corpus</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Path to the validation folder for the given corpus</span>
        <span class="n">corpus_name</span> <span class="o">=</span> <span class="s1">&#39;S24Ever&#39;</span>
        <span class="n">path2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
        <span class="c1"># Output path to the given corpus</span>
        <span class="n">path2out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;valoutput&#39;</span><span class="p">]</span>
        <span class="c1"># Path to the topic models folder</span>
        <span class="n">model2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_2_validate</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DMs</span><span class="p">,</span> <span class="n">model2val</span><span class="p">,</span> <span class="n">path2val</span><span class="p">,</span> <span class="n">path2out</span><span class="p">,</span>
                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">val_params</span><span class="p">)</span>
        <span class="n">V</span><span class="o">.</span><span class="n">validate_subtrain_models</span><span class="p">()</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerCMD.show_subtrain_results"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerCMD.show_subtrain_results">[docs]</a>    <span class="k">def</span> <span class="nf">show_subtrain_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows the results of the topic model validation in</span>
<span class="sd">        self.validate_subtrain_models()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Path to the validation folder for the given corpus</span>
        <span class="n">corpus_name</span> <span class="o">=</span> <span class="s1">&#39;S24Ever&#39;</span>
        <span class="n">path2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
        <span class="c1"># Output path to the given corpus</span>
        <span class="n">path2out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2p</span> <span class="o">/</span> <span class="n">corpus_name</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_struct</span><span class="p">[</span><span class="s1">&#39;valoutput&#39;</span><span class="p">]</span>
        <span class="c1"># Path to the topic models folder</span>
        <span class="n">model2val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_2_validate</span><span class="p">[</span><span class="n">corpus_name</span><span class="p">]</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">corpus_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DMs</span><span class="p">,</span> <span class="n">model2val</span><span class="p">,</span> <span class="n">path2val</span><span class="p">,</span> <span class="n">path2out</span><span class="p">,</span>
                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">val_params</span><span class="p">)</span>
        <span class="n">V</span><span class="o">.</span><span class="n">show_subtrain_results</span><span class="p">()</span>

        <span class="k">return</span></div></div>


<span class="c1">##############################################################################</span>
<span class="c1">#                          ITMTTaskManagerGUI                                #</span>
<span class="c1">##############################################################################</span>
<div class="viewcode-block" id="ITMTTaskManagerGUI"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerGUI">[docs]</a><span class="k">class</span> <span class="nc">ITMTTaskManagerGUI</span><span class="p">(</span><span class="n">ITMTTaskManager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides extra functionality to the task manager, to be used by the</span>
<span class="sd">    Graphical User Interface (GUI)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ITMTTaskManagerGUI.__init__"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerGUI.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p2p</span><span class="p">,</span> <span class="n">p2parquet</span><span class="p">,</span> <span class="n">config_fname</span><span class="o">=</span><span class="s1">&#39;config.cf&#39;</span><span class="p">,</span>
                 <span class="n">metadata_fname</span><span class="o">=</span><span class="s1">&#39;metadata.yaml&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes an ITMTTaskManagerGUI object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p2p : pathlib.Path</span>
<span class="sd">            Path to the application project</span>
<span class="sd">        p2parquet : pathlib.Path</span>
<span class="sd">            Path to the folder hosting the parquet datasets</span>
<span class="sd">        config_fname : str, optional (default=&#39;config.cf&#39;)</span>
<span class="sd">            Name of the configuration file</span>
<span class="sd">        metadata_fname : str or None, optional (default=metadata.yaml)</span>
<span class="sd">            Name of the project metadata file.</span>
<span class="sd">            If None, no metadata file is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">p2p</span><span class="p">,</span> <span class="n">p2parquet</span><span class="p">,</span> <span class="n">config_fname</span><span class="o">=</span><span class="n">config_fname</span><span class="p">,</span> <span class="n">metadata_fname</span><span class="o">=</span><span class="n">metadata_fname</span><span class="p">)</span></div>

<div class="viewcode-block" id="ITMTTaskManagerGUI.listDownloaded"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerGUI.listDownloaded">[docs]</a>    <span class="k">def</span> <span class="nf">listDownloaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gui</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method gets all Datasets that have been retrieved from HDFS and are available for the Model Trainer and</span>
<span class="sd">        displays them in the corresponding table within the GUI.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gui : src.gui.main_window.MainWindow</span>
<span class="sd">            QMainWindow object associated which the GUI</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allDtsets</span><span class="p">:</span>
            <span class="n">allDtsets</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allDtsets</span><span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">table_available_local_corpus</span>
            <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">Dts</span> <span class="ow">in</span> <span class="n">allDtsets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;schema&#39;</span><span class="p">]])))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;records&#39;</span><span class="p">]))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;download_date&#39;</span><span class="p">]))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">allDtsets</span><span class="p">[</span><span class="n">Dts</span><span class="p">][</span><span class="s1">&#39;visibility&#39;</span><span class="p">]))</span>
                <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerGUI.createTMCorpus"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerGUI.createTMCorpus">[docs]</a>    <span class="k">def</span> <span class="nf">createTMCorpus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># @ TODO: To be implemented when UI ready</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerGUI.listTMCorpus"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerGUI.listTMCorpus">[docs]</a>    <span class="k">def</span> <span class="nf">listTMCorpus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gui</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method shows all (logical) Datasets available for training Topic Models in the corresponding table</span>
<span class="sd">        within the GUI.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gui : src.gui.main_window.MainWindow</span>
<span class="sd">            QMainWindow object associated which the GUI</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allTrDtsets</span><span class="p">:</span>
            <span class="n">allTrDtsets</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allTrDtsets</span><span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">table_available_training_datasets</span>
            <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">TrDts</span> <span class="ow">in</span> <span class="n">allTrDtsets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;valid_for&#39;</span><span class="p">]))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;creation_date&#39;</span><span class="p">]))</span>
                <span class="n">table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;visibility&#39;</span><span class="p">]))</span>
                <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="ITMTTaskManagerGUI.deleteTMCorpus"><a class="viewcode-back" href="../../../src.project_manager.itmt_task_manager.html#src.project_manager.itmt_task_manager.ITMTTaskManagerGUI.deleteTMCorpus">[docs]</a>    <span class="k">def</span> <span class="nf">deleteTMCorpus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">corpus_to_delete</span><span class="p">,</span> <span class="n">gui</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes the training corpus given by &#39;corpus_to_delete&#39; from the Interactive Topic Model Trainer dataset folder.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        corpus_to_delete : str</span>
<span class="sd">            Name of the corpus selected by the user in the GUI to be deleted</span>
<span class="sd">        gui : src.gui.main_window.MainWindow</span>
<span class="sd">            QMainWindow object associated which the GUI</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allTrDtsets</span><span class="p">:</span>
            <span class="n">allTrDtsets</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allTrDtsets</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">TrDts</span> <span class="ow">in</span> <span class="n">allTrDtsets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">corpus_to_delete</span><span class="p">:</span>
                    <span class="n">reply</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="n">gui</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">SMOOTH_SPOON_MSG</span><span class="p">,</span> <span class="s1">&#39;Training Dataset &#39;</span> <span class="o">+</span>
                                                 <span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; will be deleted. Proceed?&#39;</span><span class="p">,</span>
                                                 <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">reply</span> <span class="o">==</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_TrDtset</span><span class="p">(</span><span class="n">TrDts</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">gui</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">SMOOTH_SPOON_MSG</span><span class="p">,</span> <span class="s1">&#39;Training Dataset &#39;</span> <span class="o">+</span>
                                                <span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; could not be deleted.&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="n">gui</span><span class="p">,</span> <span class="n">Constants</span><span class="o">.</span><span class="n">SMOOTH_SPOON_MSG</span><span class="p">,</span> <span class="s1">&#39;Training Dataset &#39;</span> <span class="o">+</span>
                                                    <span class="n">allTrDtsets</span><span class="p">[</span><span class="n">TrDts</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; was deleted successfully.&#39;</span><span class="p">)</span>

        <span class="k">return</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, J. Arenas-García, L. Calvo-Bartolomé, J. A. Espinosa-Melchor.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>